## Definition of Code Hallucinations:
- **Hallucination in NLG**: The current definition of hallucinations aligns with prior research (Ji et al., 2023a), characterizing them as generated content that is **nonsensical or unfaithful** to the provided source content. 


- **Hallucination in Code**: 
   + Faithfulness Hallucination: The code generated by LLM is conflict with the instruction (task description, or the context provided by the input) and the self-consistency within generated code.

   + Knowledge (Factuality) Hallucination: the discrepancy between generated code and verifiable real-world facts (like common sense of life, natural science knowledge), programming knowledge (Algorithm/library knowledge), and domain-specific knowldges  (such as project-specific information like user-defined class details within a project).




## 交叉分类法

#### 一、产生因素

1. prompt相关
   - **P1：**复杂逻辑
   - **P2：**过长
   - **P3：**模糊
   - **P4：**不完整
   - ......
2. 模型相关
   - **M1：**模型逻辑能力
   - **M2：**模型知识储备

#### 二、幻觉模式

1. 需求冲突（对应于输入冲突）

   - **R1：**功能性需求冲突（代码的的某一部分（或全部）与prompt的某个**关键词/语句**之间存在**直接的**语义冲突，并且影响了代码的功能正确性）**（需备注prompt中具体冲突内容）**

     > 例1：prompt要求最大值，代码求的是最小值
     >
     > 例2：基于函数补全的数据集的函数签名错误

     > 反例：蜗牛爬井问题中，直接用井深除以每日净升高高度（并没有直接地与prompt产生冲突）

   - 非功能性需求冲突（代码未满足prompt中一些和功能无关的需求）

     - **R21：**时间复杂度
     - **R22：**空间复杂度
     - **R23：**代码风格 
     - ......

2. 代码一致性冲突（对应于上下文冲突，代码中各部分之间的显式逻辑冲突）
   - **C1：**对未定义变量的引用**（备注中给出）**
   - **C2：**结果未被后续代码使用的语句/代码片段
   - **C3：**代码前后逻辑割裂
   - **C4：**代码前后使用不一致的工具库**（备注中给出）**
   - ......
   
3. 知识冲突（对应于事实冲突，在代码中使用了错误的知识）
   - **K1：**生活常识（e.g. 闰年的计算）
   - **K2：**数学与自然科学知识（e.g. 三角形面积计算公式、物理公式、地理坐标）
   - 计算机知识
     - **K31：**算法知识（算法的原理和实现）
     - **K32：**代码库知识（包括标准库和广泛使用的第三方库）
     - **K33：**计算机理论知识（e.g. 反码与补码）
   - ......



#### 三、影响

1. **A1：**功能（可能通过了测试用例但仍然有功能错误，这时需要**提供不能通过的例子（trigger testcase**））
2. **A2：**执行效率（过高的时间复杂度、多余的操作等）
2. **A3：**内存占用（无用或可简化的变量、过高的空间复杂度等）
3. **A4：**可读性
3. **A5：**可维护性和可扩展性
4. ......



## 一些不属于幻觉的代码模式
1. 语法错误
2. 不完整：
   - 需求（明确地）包含多个阶段/步骤，但只实现了其中部分阶段
   - 需求（明确地）要求进行多个并行地动作，但只实现了其中部分动作
   - 需求（明确地）指出结果（或过程中）需要满足多个条件，但只进行了部分条件的判断
   - .......
3. 无效生成：未生成代码或者生成无实际意义的代码
4. 重复：包括对输入的重复和代码内部的重复
5. 恒等式：e.g. `a = a + 1 - 1`
6. 可简化逻辑：e.g. `a = 1 if b > 0  else 1`
7. ......



## 标注内容

#### 提示词标注

- 逻辑复杂度（1-5）
- 是否存在模糊/有歧义的逻辑 
- 是否存在不完整的描述

#### 代码幻觉标注（每份代码可标注多个）

- 行号（start lineno，end lineno）
- 产生因素（可多选）
- 幻觉模式（单选）
- 影响（可多选）





